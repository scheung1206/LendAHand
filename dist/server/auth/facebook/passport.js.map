{"version":3,"sources":["../../../../server/auth/facebook/passport.js"],"names":[],"mappings":";;;;;;;;;wBAAqB,UAAU;;;;gCACY,mBAAmB;;AAEvD,SAAS,KAAK,CAAC,IAAI,EAAE,MAAM,EAAE;AAClC,wBAAS,GAAG,CAAC,+BAAqB;AAChC,YAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ;AAClC,gBAAY,EAAE,MAAM,CAAC,QAAQ,CAAC,YAAY;AAC1C,eAAW,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW;AACxC,iBAAa,EAAE,CACb,aAAa,EACb,QAAQ,CACT;GACF,EACD,UAAS,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,IAAI,EAAE;AACjD,QAAI,CAAC,YAAY,CAAC;AAChB,mBAAa,EAAE,OAAO,CAAC,EAAE;KAC1B,CAAC,CACC,IAAI,CAAC,UAAA,IAAI,EAAI;AACZ,UAAI,IAAI,EAAE;AACR,eAAO,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACzB;;AAED,UAAI,GAAG,IAAI,IAAI,CAAC;AACd,YAAI,EAAE,OAAO,CAAC,WAAW;AACzB,aAAK,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK;AAC9B,YAAI,EAAE,MAAM;AACZ,gBAAQ,EAAE,UAAU;AACpB,gBAAQ,EAAE,OAAO,CAAC,KAAK;OACxB,CAAC,CAAC;AACH,UAAI,CAAC,SAAS,EAAE,CACb,IAAI,CAAC,UAAA,IAAI;eAAI,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC;OAAA,CAAC,SACzB,CAAC,UAAA,GAAG;eAAI,IAAI,CAAC,GAAG,CAAC;OAAA,CAAC,CAAC;KAC5B,CAAC,SACI,CAAC,UAAA,GAAG;aAAI,IAAI,CAAC,GAAG,CAAC;KAAA,CAAC,CAAC;GAC5B,CAAC,CAAC,CAAC;CACL","file":"passport.js","sourcesContent":["import passport from 'passport';\r\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\r\n\r\nexport function setup(User, config) {\r\n  passport.use(new FacebookStrategy({\r\n    clientID: config.facebook.clientID,\r\n    clientSecret: config.facebook.clientSecret,\r\n    callbackURL: config.facebook.callbackURL,\r\n    profileFields: [\r\n      'displayName',\r\n      'emails'\r\n    ]\r\n  },\r\n  function(accessToken, refreshToken, profile, done) {\r\n    User.findOneAsync({\r\n      'facebook.id': profile.id\r\n    })\r\n      .then(user => {\r\n        if (user) {\r\n          return done(null, user);\r\n        }\r\n\r\n        user = new User({\r\n          name: profile.displayName,\r\n          email: profile.emails[0].value,\r\n          role: 'user',\r\n          provider: 'facebook',\r\n          facebook: profile._json\r\n        });\r\n        user.saveAsync()\r\n          .then(user => done(null, user))\r\n          .catch(err => done(err));\r\n      })\r\n      .catch(err => done(err));\r\n  }));\r\n}\r\n"]}