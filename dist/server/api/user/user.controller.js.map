{"version":3,"sources":["../../../../server/api/user/user.controller.js"],"names":[],"mappings":"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","file":"user.controller.js","sourcesContent":["'use strict';\r\n\r\nimport User from './user.model';\r\nimport passport from 'passport';\r\nimport config from '../../config/environment';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nfunction validationError(res, statusCode) {\r\n  statusCode = statusCode || 422;\r\n  return function(err) {\r\n    res.status(statusCode).json(err);\r\n  }\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n  statusCode = statusCode || 500;\r\n  return function(err) {\r\n    res.status(statusCode).send(err);\r\n  };\r\n}\r\n\r\n\r\nfunction respondWithResult(res, statusCode) {\r\n  statusCode = statusCode || 200;\r\n  return function(entity) {\r\n    if (entity) {\r\n      res.status(statusCode).json(entity);\r\n    }\r\n  };\r\n}\r\n\r\nfunction saveUpdates(updates) {\r\n  return function(entity) {\r\n    var updated = _.extend(entity, updates);\r\n    return updated.saveAsync()\r\n      .spread(updated => {\r\n        return updated;\r\n      });\r\n  };\r\n}\r\n\r\nfunction handleEntityNotFound(res) {\r\n  return function(entity) {\r\n    if (!entity) {\r\n      res.status(404).end();\r\n      return null;\r\n    }\r\n    return entity;\r\n  };\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n  statusCode = statusCode || 500;\r\n  return function(err) {\r\n    res.status(statusCode).send(err);\r\n  };\r\n}\r\n\r\nfunction handleUnauthorized(req, res) {\r\n  return function(entity) {\r\n    if (!entity) {return null;}\r\n    if(entity.user._id.toString() !== req.user._id.toString()){\r\n      res.send(403).end();\r\n      return null;\r\n    }\r\n    return entity;\r\n  }\r\n}\r\n\r\n/**\r\n * Get list of users\r\n * restriction: 'admin'\r\n */\r\nexport function index(req, res) {\r\n  User.findAsync({}, '-salt -password')\r\n    .then(users => {\r\n      res.status(200).json(users);\r\n    })\r\n    .catch(handleError(res));\r\n}\r\n\r\n/**\r\n * Creates a new user\r\n */\r\nexport function create(req, res, next) {\r\n  var newUser = new User(req.body);\r\n  newUser.provider = 'local';\r\n  newUser.role = 'user';\r\n  newUser.saveAsync()\r\n    .spread(function(user) {\r\n      var token = jwt.sign({ _id: user._id }, config.secrets.session, {\r\n        expiresIn: 60 * 60 * 5\r\n      });\r\n      res.json({ token });\r\n    })\r\n    .catch(validationError(res));\r\n}\r\n\r\n\r\n// Update user info\r\n// export function update (req, res){\r\n//   var userId = req.user._id;\r\n//   var newName = req.body.name;\r\n//   var newSkills = req.body.background.skills;\r\n//   var newBiography = req.body.background.biography;\r\n//   var newLocation = req.body.background.location;\r\n//   User.findByIdAsync(userId) //Modify to accomadate for user updates instead\r\n//     .then(user => {\r\n//         user.name = newName;\r\n//         user.background.skills = newSkills;\r\n//         user.background.location = newLocation;\r\n//         user.background.biography = newBiography;\r\n//         return user.saveAsync()\r\n//           .then(() => {\r\n//             res.status(204).end();\r\n//           })\r\n//           .catch(validationError(res));\r\n//     });\r\n// }\r\n\r\nexport function update(req, res) { //stevens\r\n  console.log(req.body);\r\n  var userId = req.user._id;\r\n  var newBio = req.body.background.biography;\r\n  console.log(newBio);\r\n  console.log(req.user._id);\r\n\r\n  User.findByIdAsync(userId)\r\n    .then(user => {\r\n        console.log(user);\r\n          console.log(req.user);\r\n\r\n        user.background.biography = newBio;\r\n        return user.saveAsync()\r\n          .then(() => {\r\n            res.status(204).end();\r\n          })\r\n          .catch(validationError(res));\r\n\r\n    });\r\n}\r\n\r\n//Post review on Profile code\r\nexport function createReview(req, res) {\r\n  req.body.user = req.user;\r\n  console.log(req.body);\r\n  User.update({_id: req.params.id}, {$push: {reviews: req.body}}, function(err, num) {\r\n    if(err) { return handleError(res)(err); }\r\n    if(num === 0) { return res.send(404).end(); }\r\n    exports.show(req, res);\r\n    //Post.updateSearchText(req.params.id);\r\n  });\r\n}\r\n\r\nexport function destroyReview(req, res) {\r\n  User.update({_id: req.params.id}, {$pull: {reviews: {_id: req.params.reviewId , 'user': req.user._id}}}, function(err, num) {\r\n    if(err) { return handleError(res)(err); }\r\n    if(num === 0) { return res.send(404).end(); }\r\n    exports.show(req, res);\r\n  });\r\n}\r\n\r\nexport function updateReview(req, res) {\r\n  User.update({_id: req.params.id, 'reviews._id': req.params.reviewId}, {'reviews.$.content': req.body.content, 'reviews.$.rating': req.body.rating, 'reviews.$.user': req.user.id}, function(err, num){\r\n    if(err) { return handleError(res)(err); }\r\n    if(num === 0) { return res.send(404).end(); }\r\n    exports.show(req, res);\r\n  });\r\n}\r\n\r\n/**\r\n * Get a single user\r\n */\r\nexport function show(req, res, next) {\r\n  var userId = req.params.id;\r\n\r\n  User.findByIdAsync(userId)\r\n    .then(user => {\r\n      if (!user) {\r\n        return res.status(404).end();\r\n      }\r\n      res.json(user.profile);\r\n    })\r\n    .catch(err => next(err));\r\n}\r\n\r\nexport function update(req, res) {\r\n  console.log(req.body);\r\n  var userId = req.user._id;\r\n  var newName = req.body.name;\r\n  var newBio = req.body.background.biography;\r\n  var newSkills = req.body.background.skills;\r\n  var newHobbies = req.body.background.hobbies;\r\n  var newImage = req.body.background.image;\r\n  console.log(newSkills);\r\n  console.log(req.user._id);\r\n\r\n  User.findByIdAsync(userId)\r\n    .then(user => {\r\n        //console.log(user);\r\n        //  console.log(req.user);\r\n        user.name = newName;\r\n        user.background.biography = newBio;\r\n        user.background.skills = newSkills;\r\n        user.background.hobbies = newHobbies;\r\n        user.background.image = newImage;\r\n        return user.saveAsync()\r\n          .then(() => {\r\n            res.status(204).end();\r\n          })\r\n          .catch(validationError(res));\r\n\r\n    });\r\n}\r\n\r\n/**\r\n * Deletes a user\r\n * restriction: 'admin'\r\n */\r\nexport function destroy(req, res) {\r\n  User.findByIdAndRemoveAsync(req.params.id)\r\n    .then(function() {\r\n      res.status(204).end();\r\n    })\r\n    .catch(handleError(res));\r\n}\r\n\r\n/**\r\n * Change a users password\r\n */\r\nexport function changePassword(req, res, next) {\r\n  var userId = req.user._id;\r\n  var oldPass = String(req.body.oldPassword);\r\n  var newPass = String(req.body.newPassword);\r\n\r\n  User.findByIdAsync(userId)\r\n    .then(user => {\r\n      if (user.authenticate(oldPass)) {\r\n        user.password = newPass;\r\n        return user.saveAsync()\r\n          .then(() => {\r\n            res.status(204).end();\r\n          })\r\n          .catch(validationError(res));\r\n      } else {\r\n        return res.status(403).end();\r\n      }\r\n    });\r\n}\r\n\r\n/**\r\n * Get my info\r\n */\r\nexport function me(req, res, next) {\r\n  var userId = req.user._id;\r\n\r\n  User.findOneAsync({ _id: userId }, '-salt -password')\r\n    .then(user => { // don't ever give out the password or salt\r\n      if (!user) {\r\n        return res.status(401).end();\r\n      }\r\n      res.json(user);\r\n    })\r\n    .catch(err => next(err));\r\n}\r\n\r\nexport function like(req, res) {\r\n  User.update({_id: req.params.id}, {$push: {likes: req.user.id}}, function(err, num){\r\n    if(err) { return handleError(res)(err); }\r\n    if(num === 0) { return res.send(404).end(); }\r\n    exports.show(req, res);\r\n  });\r\n}\r\nexport function unlike(req, res) {\r\n  User.update({_id: req.params.id}, {$pull: {likes: req.user.id}}, function(err, num){\r\n    if(err) { return handleError(res, err); }\r\n    if(num === 0) { return res.send(404).end(); }\r\n    exports.show(req, res);\r\n  });\r\n}\r\n\r\n/**\r\n * Authentication callback\r\n */\r\nexport function authCallback(req, res, next) {\r\n  res.redirect('/');\r\n}\r\n"]}